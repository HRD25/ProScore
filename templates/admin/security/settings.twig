{% extends '/admin/layout/layout.twig' %}

{% block content %}
<div class="container h-100">
    <nav class="mt-4">
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <button class="nav-link profil active"  data-page="nav_profile" id="button_nav_profile">Profil</button>
        </div>
    </nav>
        {% include 'admin/elements/alert/alert_box.twig' %}
        <div class="admin_logo_dropzone d-none"></div>
  
        <form method="POST" class="h-100">
            <div class="page_view" id="nav_profile" style="height: 100%">
                <div class="row h-100" >
                  
                        <div class="col-sm-5" style="position: relative">
                            <div class="admin_logo mt-4" style="border: 1px solid grey; width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;min-height: 140px; border-radius: 50%;position: relative;">

                                {% if app.user.photo is not empty  %}
                                 <div class="" style="width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;border-radius: 50%;position: relation;">
                                      <div class="admin_logo_box">
                                            <a class="remove_logo_admin" style="color: #d92550;position: absolute;right: -14px;cursor: pointer;"><i class="fas fa-times"></i></a>
                                            <img src="{{ asset('/admin_logo/' ~ app.user.photo.safeName ~ '.' ~ app.user.photo.extension )}}" style="width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;border-radius: 50%;">
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="" style="width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;background: grey;opacity: 0.3;border-radius: 50%;">
                                        <span class="" style="position: absolute;top: 50px;left: 53px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="white" class="bi bi-camera" viewBox="0 0 16 16">
                                            <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/>
                                            <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
                                            </svg>
                                        </span>
                                    </div>
                                {% endif %}
                                
                            </div>
                        </div>
                        <div class="col-sm-7" style="position: relative">
                        
                            <div class="mb-3 row mt-3">
                                <label for="change_email" class="col-sm-2 col-form-label">Email</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control" name="change_email" id="change_email" placeholder="E-mail" value="{{ app.user.email|default('') }}">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="old_password" class="col-sm-2 col-form-label">Obecne hasło</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" name="old_password" placeholder="Obecne hasło" id="old_password">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="change_password" class="col-sm-2 col-form-label">Nowe hasło</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" name="change_password" placeholder="Nowe hasło" id="change_password">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label for="change_password_2" class="col-sm-2 col-form-label">Powtórz hasło</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" name="change_password_2" placeholder="Powtórz hasło" id="change_password_2">
                                </div>
                            </div>

                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-dark  text-center">Zapisz</button>
                            </div>
                        </div>
                </div>
            </div>
        </form>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
const defaultPhoto = () => {
    return `
    <div class="" style="width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;background: grey;opacity: 0.3;border-radius: 50%;">
        <span class="" style="position: absolute;top: 50px;left: 53px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="white" class="bi bi-camera" viewBox="0 0 16 16">
            <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/>
            <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/>
            </svg>
        </span>
    </div>`;
}

const newPhoto = (logo) => {
  return `
      <div class="admin_logo_box">
          <a class="remove_logo_admin" style="color: #d92550;position: absolute;right: -21px;top: -17px;cursor: pointer;"><i class="fas fa-times"></i></a>
          <img src="/admin_logo/`+logo+`" style="width: 140px; height: 140px;max-width: 140px;min-width: 70px;max-height: 140px;border-radius: 50%;">
      </div>
  `;
}

$(document).on('click', '.nav-link', function(){
    let page = $(this).data('page');
    $('.nav-link').removeClass('active');
    $(this).addClass('active');
    $('.page_view').hide();
    $('#'+page).show();
});

$(document).on('click', '.admin_logo', function(){
   $('.admin_logo_dropzone').click();
});

$(document).on('click', '.remove_logo_admin', function(){
    Dropzone.forElement('.admin_logo_dropzone').removeAllFiles(true);
    $('.admin_logo').empty();
    $('.admin_logo').append(defaultPhoto());
});

$(".admin_logo_dropzone").dropzone({
    url: '/admin-logo-upload',
    maxFiles: 1,
    acceptedFiles: 'image/*',
    createImageThumbnails: false,
    addRemoveLinks: false,
    previewsContainer: false,
    success: function (file, response) {
        if(response.logo != ''){
            $('.admin_logo').empty();
            $('.admin_logo').append(newPhoto(response.logo));
        }else{
            $('.admin_logo').empty();
            $('.admin_logo').append(defaultPhoto());
        }
    }
});
</script>
{% endblock %}
